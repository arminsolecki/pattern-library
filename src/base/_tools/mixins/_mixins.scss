/*------------------------------------*\
    MIXINS
\*------------------------------------*/

$blocklink__outline-width: 0;
$link__outline-width: 2px;
$link__border-width: 3px;

/// Media query
///
/// Shorthand @media alias that keeps media query rules to a defined set of
/// breakpoints.
///
/// @param {string} $breakpoint - name of the breakpoint to use
///
/// @example scss
///   @include ds_media-query(medium) {
///     .my-element {
///        display: block;
///     }
///   }

@mixin ds_media-query($breakpoint) {
    // validate param
    @if not map-has-key($ds_breakpoints, $breakpoint) {
        @error 'Breakpoint "#{$breakpoint}" not defined.';
    }

    $condition: map-get($ds_breakpoints, $breakpoint);

    @media #{$condition} {
        @content;
    }
}

@mixin ds_chevron($orientation: down, $size: 1em) {
    content: '';
    display: inline-block;
    height: $size * 2;
    transition: transform 0.2s, top 0.2s;
    width: $size * 2;

    $spritename: 'expand_more';
    @if $orientation == down {
        $spritename: 'expand_more';
    } @else if $orientation == up {
        $spritename: 'expand_less';
    } @else if $orientation == left {
        $spritename: 'chevron_left';
    } @else if $orientation == right {
        $spritename: 'chevron_right';
    }

    $octothorpe: '#';
    @include ds_icon-mask(#{$iconsfile}#{$octothorpe}#{$spritename});
}

/// Link
///
/// Single definition to enforce consistent display of links and elements that
/// look like links (e.g. buttons we want to have display with a link-like style)

@mixin ds_link {
    color: $ds_colour__link;
    text-decoration: underline;
    outline: $link__outline-width solid transparent;
    text-underline-offset: 1px;
    transition: color $transition-out-time, background-color $transition-out-time, outline $transition-out-time;

    &:hover {
        background-color: $ds_colour__link--hover__background;
        color: $ds_colour__link--hover;
        outline: $link__outline-width solid $ds_colour__link--hover__background;
        transition-duration: $transition-in-time;
    }

    &:focus {
        background-color: $ds_colour__link--focus__background;
        box-shadow: #{$link__outline-width * -1} #{$link__outline-width + $link__border-width} $ds_colour__link--focus__shadow, $link__outline-width #{$link__outline-width + $link__border-width} $ds_colour__link--focus__shadow;
        color: $ds_colour__link--focus;
        outline: $link__outline-width solid $ds_colour__link--focus__outline;
        outline-offset: 0;
        text-decoration: none;
        transition-duration: 0s;
    }

    > svg {
        fill: currentColor;
    }
}


/// Blocklink
///
/// Mixin to enforce consistency on block-style links, e.g. search results, category items, etc
///
/// @param {string} $link-selector - child element that is used as the link, optional
/// @param {boolean} $hover - whether to apply a hover state

@mixin ds_blocklink ($link-selector: null, $hover: true) {
    display: block;
    position: relative;
    transition: background-color $transition-out-time, outline-color $transition-out-time;
    z-index: 1;

    outline: 0 !important;

    &:focus {
        background-color: $ds_colour__blocklink-bg--focus;
        box-shadow: inset #{$blocklink__outline-width * -1} #{$blocklink__outline-width + $link__border-width * -1} $ds_colour__link--focus__shadow, inset $blocklink__outline-width #{$blocklink__outline-width + $link__border-width * -1} $ds_colour__link--focus__shadow;
    }

    @if $hover {
        &:hover:not(:focus) {
            background-color: $ds_colour__blocklink-bg--hover;
        }
    }

    @if $link-selector {
        #{$link-selector} {
            &:focus:hover {
                text-decoration: none;
            }
        }

        /*
            supports grid is a hack as a proxy for supports :focus-within
        */
        @supports (display: grid) {
            #{$link-selector} {
                background-color: transparent;
                outline: none;

                &::after {
                    content: "";
                    height: 100%;
                    left: 0px;
                    position: absolute;
                    top: 0px;
                    width: 100%;
                    z-index: 0;
                }

                &:focus {
                    &::after {
                        transition-duration: 0s;
                    }
                }
            }

            &:focus-within {
                background-color: $ds_colour__blocklink-bg--focus !important;
                box-shadow: inset 0 -3px #333333, inset 0 -3px #333333;
                transition-duration: 0s;

                #{$link-selector} {
                    &:focus {
                        box-shadow: none;
                        background-color: transparent;
                    }
                }
            }
        }
    }
}

@mixin ds_blocklink--solid($link-selector: null) {
    @include ds_blocklink($link-selector);

    background-color: $ds_colour__white;
}

/// Fancy underscore
///
/// Animated underscore used on logo images, site nav
///
/// @param {string} $width - width of the underscore

@mixin ds_fancy-underscore($width: 1px) {
    position: relative;
    transition-duration: 0s !important;

    &:hover:not(:focus) {
        background: transparent;
        outline-color: transparent;
    }

    &::after {
        background-color: currentColor;
        bottom: -5px;
        content: '';
        height: $width;
        left: 50%;
        opacity: 0;
        position: absolute;
        right: 50%;
        transition: left $transition-in-time, right $transition-in-time, opacity $transition-in-time;
    }

    &:hover::after {
        left: 0;
        opacity: 1;
        right: 0;
    }
}

/// Block margins
///
/// Single definition for consistent spacing

@mixin ds_block-margins {
    margin-top: 32px;
    margin-bottom: 32px;
}

@mixin ds_block-margins--bottom {
    margin-bottom: 32px;
}

/// Box shadow
///
/// Single definition for consistent box shadows

@mixin ds_box-shadow {
    box-shadow: 1px 1px 4px rgba(0, 0, 0, 0.15);
}

/// Indicator
///
/// Single definition for consistent open/close icons, mobile section nav, accordions, etc

@mixin ds_indicator {
    @include ds_chevron(down);
    right: 14px;
    position: absolute;
}

@mixin ds_indicator--open {
    transform: rotateZ(180deg);
}

@mixin ds_colwidth($columns: 1, $total: 12, $gutter: $grid-gap-x) {
    width: calc(100% * #{$columns/$total} - #{$gutter});
}

@mixin ds_colpush($columns: 1, $total: 12) {
    margin-left: calc(100% * #{$columns/$total});
}

@mixin ds_colpull($columns: 1, $total: 12) {
    margin-left: calc(100% * #{$columns/$total} * -1);
}

@mixin ds_layout($gutter: $grid-gap-x, $sub: false) {
    @if $sub {} @else {
        margin-right: #{$gutter * -1};
    }
    overflow: hidden;

    > * {
        margin-right: $gutter;
    }

    @supports (display: grid) {
        display: grid;
        grid-gap: 0 $gutter;
        margin-right: 0;
        overflow: visible;

        > * {
            margin-left: 0;
            margin-right: 0;
            width: auto !important;
        }
    }
}

/// Icon mask
///
/// Adds mask-image properties for a provided image URL
///
/// @param {string} $url - url of the image to be masked
///
/// @example scss
///   .warning-icon {
///     @include ds_icon-mask('/path/to/my/icon')
///   }

@mixin ds_icon-mask($url) {
    /// for IE11 support, use image without clip path
    background-image: url($url);

    @supports (-webkit-mask-image: url()) or (mask-image: url()) {
        background-color: currentColor;
        background-image: none;
        -webkit-mask-image: url($url);
        mask-image: url($url);
    }
}




/// legacy non-prefixed names
@mixin chevron($orientation: down, $size: 1em) {
    @include ds_chevron($orientation, $size);
}

// general mixins
@mixin media-query($breakpoint) {
    // validate param
    @if not map-has-key($ds_breakpoints, $breakpoint) {
        @error 'Breakpoint "#{$breakpoint}" not defined.';
    }

    $condition: map-get($ds_breakpoints, $breakpoint);

    @media #{$condition} {
        @content;
    }
}

@mixin link {
    @include ds_link;
}

@mixin blocklink($link-selector: null, $hover: true) {
    @include ds_blocklink($link-selector, hover);
}

@mixin blocklink--solid($link-selector: null) {
    @include ds_blocklink--solid($link-selector);
}

@mixin fancy-underscore($width: 1px) {
    @include ds_fancy-underscore($width);
}

@mixin block-margins {
    @include ds_block-margins;
}

@mixin block-margins--bottom {
    @include ds_block-margins--bottom;
}

@mixin box-shadow {
    @include ds_box-shadow;
}

@mixin indicator {
    @include ds_indicator;
}

@mixin indicator--open {
    @include ds_indicator--open;
}

@mixin colwidth($columns: 1, $total: 12, $gutter: $grid-gap-x) {
    @include ds_colwidth($columns, $total, $gutter);
}

@mixin colpush($columns: 1, $total: 12) {
    @include ds_colpush($columns, $total);
}

@mixin colpull($columns: 1, $total: 12) {
    @include ds_colpull($columns, $total);
}

@mixin layout($gutter: $grid-gap-x, $sub: false) {
    @include ds_layout($gutter, $sub);
}

@mixin icon-mask($url) {
    @include ds_icon-mask($url);
}
